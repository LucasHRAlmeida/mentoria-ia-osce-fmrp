<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mentoria IA OSCE FMRP-USP</title>
  <style>
    :root {
      --color-background: var(--color-cream-50, #FCFCF9);
      --color-surface: var(--color-cream-100, #FFFFFD);
      --color-text: var(--color-slate-900, #13343B);
      --color-text-secondary: var(--color-slate-500, #626C71);
      --color-primary: var(--color-teal-500, #21808D);
      --color-primary-hover: var(--color-teal-600, #1D7480);
      --color-secondary: rgba(94, 82, 64, 0.12);
      --color-border: rgba(94, 82, 64, 0.2);
      --radius-base: 8px;
      --space-8: 8px;
      --space-12: 12px;
      --space-16: 16px;
      --space-24: 24px;
      --font-size-lg: 16px;
      --font-size-xl: 18px;
      --font-size-3xl: 24px;
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.08), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
    body {
      background: var(--color-background);
      color: var(--color-text);
      font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      margin: 0;
      min-height: 100vh;
      padding: 0;
    }
    header {
      background: var(--color-surface);
      box-shadow: var(--shadow-md);
      padding: var(--space-16) 0;
      margin-bottom: var(--space-16);
      border-bottom: 1px solid var(--color-border);
      text-align: center;
    }
    h1 {
      font-size: var(--font-size-3xl);
      margin: 0 0 var(--space-8) 0;
      color: var(--color-primary);
    }
    .syllabus {
      max-width: 920px;
      margin: 0 auto var(--space-16) auto;
      padding: var(--space-16);
      background: var(--color-surface);
      border-radius: var(--radius-base);
      box-shadow: var(--shadow-md);
      border: 1px solid var(--color-border);
    }
    .main-content {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-16);
      max-width: 1180px;
      margin: auto;
    }
    .stations, .dashboard {
      flex: 1 1 340px;
      background: var(--color-surface);
      border-radius: var(--radius-base);
      padding: var(--space-16);
      border: 1px solid var(--color-border);
      box-shadow: var(--shadow-md);
      min-width: 320px;
    }

    .stations h2 {
      font-size: var(--font-size-xl);
      margin-bottom: var(--space-8);
      color: var(--color-primary);
    }
    .phases-nav {
      margin-bottom: var(--space-12);
      display: flex;
      gap: var(--space-8);
      flex-wrap: wrap;
    }
    .phase-btn {
      padding: var(--space-8) var(--space-16);
      border-radius: var(--radius-base);
      background: var(--color-secondary);
      color: var(--color-primary);
      font-weight: 500;
      border: none;
      cursor: pointer;
      transition: background 0.2s;
    }
    .phase-btn.active {
      background: var(--color-primary);
      color: #fff;
    }
    .station-card {
      margin-bottom: var(--space-16);
      padding: var(--space-8) var(--space-12);
      background: #fff9;
      border-radius: var(--radius-base);
      border-left: 4px solid var(--color-primary);
      box-shadow: 0 1px 4px rgba(0,0,0,0.04);
    }
    .station-card h3 {
      margin: 0 0 4px 0;
      font-size: var(--font-size-lg);
      color: var(--color-text-secondary);
    }
    .question-block {
      margin: 0 0 var(--space-8) 0;
    }
    .input-block label {
      display: block;
      margin-bottom: 2px;
      color: var(--color-text-secondary);
      font-size: var(--font-size-lg);
    }
    .input-block input, .input-block textarea, .input-block select {
      width: 100%;
      padding: 6px;
      border-radius: var(--radius-base);
      border: 1px solid var(--color-border);
      background: var(--color-background);
      font-size: var(--font-size-lg);
      margin-bottom: var(--space-8);
    }
    .btn {
      background: var(--color-primary);
      color: #fff;
      border: none;
      border-radius: var(--radius-base);
      padding: var(--space-8) var(--space-16);
      font-size: var(--font-size-lg);
      cursor: pointer;
      font-weight: 500;
      transition: background 0.2s;
    }
    .btn:hover {
      background: var(--color-primary-hover);
    }
    .feedback-block {
      background: var(--color-secondary);
      padding: var(--space-8);
      border-radius: var(--radius-base);
      margin-top: var(--space-8);
      margin-bottom: var(--space-8);
      font-size: var(--font-size-lg);
      color: var(--color-primary);
    }
    .station-note {
      color: var(--color-text-secondary);
      font-size: 13px;
      margin-top: 2px;
    }
    .dashboard h2 {
      font-size: var(--font-size-xl);
      color: var(--color-primary);
      margin-bottom: var(--space-8);
    }
    .progress-bar-bg {
      width: 100%;
      height: 18px;
      background: var(--color-secondary);
      border-radius: var(--radius-base);
      overflow: hidden;
      margin-bottom: 6px;
      border: 1px solid var(--color-border);
    }
    .progress-bar-inner {
      height: 100%;
      background: var(--color-primary);
      transition: width 0.3s;
      color: #fff;
      font-weight: 700;
      text-align: center;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: flex-start;
      padding-left: var(--space-8);
      border-radius: var(--radius-base);
    }

    .checklist-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: var(--space-8);
      font-size: 14px;
    }
    .checklist-table th, .checklist-table td {
      border: 1px solid var(--color-border);
      padding: 4px 8px;
      text-align: left;
    }
    .checklist-ok {
      color: var(--color-primary);
      font-weight: bold;
    }
    .checklist-fail {
      color: #D91E32;
      font-weight: bold;
    }

    @media (max-width: 900px) {
      .main-content { flex-direction: column; }
      .stations, .dashboard { width: 100%; min-width: 0; }
    }

  </style>
</head>
<body>
<header>
  <h1>Mentoria IA Literacy – OSCE FMRP-USP</h1>
  <div>Syllabus resumido da mentoria e simulador prático, conforme o perfil da banca local</div>
</header>
<section class="syllabus">
  <h2>Syllabus Resumido</h2>
  <ul>
    <li><b>Fase 1:</b> Anamnese, exame dirigido, comunicação</li>
    <li><b>Fase 2:</b> Procedimentos médicos, decisão clínica SUS</li>
    <li><b>Fase 3:</b> Casos complexos, bioética, liderança</li>
    <li><b>Fase 4:</b> Avaliação OSCE final – integração das competências</li>
  </ul>
  <p><b>Formato:</b> Estações simuladas (role-play), feedback por IA, dashboard de progresso individual, checklists espelhados na FMRP-USP.<br>
  <b>Carga horária sugerida:</b> 20 horas.</p>
</section>
<main class="main-content">
  <section class="stations">
    <h2>Simulador de Estações</h2>
    <nav class="phases-nav" id="phases-nav"></nav>
    <div id="station-area"></div>
  </section>
  <section class="dashboard">
    <h2>Dashboard do Aluno</h2>
    <div>
      <b>Fase atual:</b> <span id="current-phase-label">-</span><br>
      <b>Pontuação média (por fase):</b>
      <div id="phases-progress"></div>
      <b>Histórico de Estações:</b>
      <div id="station-history"></div>
    </div>
  </section>
</main>
<script>
  // Estrutura de Fases e Estações
  const phases = [
    {
      key: "Fase 1",
      label: "Anamnese, exame, comunicação",
      stations: [
        {
          title: "Anamnese do paciente com dor abdominal aguda",
          context: "Paciente masculino, 32 anos, dor abdominal intensa há 6h, irradiação para região lombar. Simule a anamnese dirigida.",
          type: "roleplay",
          checklist: [
            { item: "Identifica sinais de gravidade (perfuração, choque, septicemia)", critical: true },
            { item: "Pergunta sobre irradiação, intensidade, duração, fatores de piora/alívio", critical: true },
            { item: "Levanta antecedentes pessoais relevantes", critical: false },
            { item: "Explora sintomas associados (náuseas, vômitos, febre, etc)", critical: false },
            { item: "Comunica-se de forma clara e empática", critical: false },
          ]
        },
        {
          title: "Exame físico cardíaco segmentar",
          context: "Paciente do sexo feminino, 57 anos, chega com dispneia e dor torácica. Realize exame cardíaco.",
          type: "roleplay",
          checklist: [
            { item: "Introduz-se e solicita consentimento", critical: false },
            { item: "Higieniza as mãos", critical: true },
            { item: "Ausculta corretamente todos os focos cardíacos", critical: true },
            { item: "Identifica sopros ou bulhas anormais", critical: false },
            { item: "Agradece ao paciente e orienta sobre resultado", critical: false },
          ]
        },
        {
          title: "Entrevista difícil: má notícia",
          context: "Paciente jovem, suspeita de diagnóstico oncológico. Simule a comunicação utilizando protocolo SPIKES.",
          type: "roleplay",
          checklist: [
            { item: "Planeja o ambiente adequadamente", critical: false },
            { item: "Usa comunicação não violenta", critical: true },
            { item: "Investiga entendimento prévio do paciente", critical: false },
            { item: "Explica o diagnóstico de modo empático e claro", critical: true },
            { item: "Oferece apoio e abertura para dúvidas", critical: false },
          ]
        },
      ]
    },
    {
      key: "Fase 2",
      label: "Procedimentos médicos, decisão clínica",
      stations: [
        {
          title: "Punção venosa periférica segura",
          context: "Paciente hipotenso, indicação de volume venoso rápido. Simule o procedimento.",
          type: "procedural",
          checklist: [
            { item: "Prepara materiais adequados", critical: true },
            { item: "Higieniza as mãos", critical: true },
            { item: "Usa EPI corretos", critical: false },
            { item: "Realiza punção com técnica asséptica", critical: true },
            { item: "Descarte correto dos materiais", critical: false },
          ]
        },
        {
          title: "Interpretação do ECG – supradesnivelamento do ST",
          context: "Paciente de 62 anos, dor precordial intensa, chegada na emergência. Interprete o ECG fornecido.",
          type: "ECG",
          checklist: [
            { item: "Identifica ritmo sinusal", critical: false },
            { item: "Reconhece supradesnivelamento de ST", critical: true },
            { item: "Aponta critérios para intervenção imediata", critical: true },
            { item: "Relata ausência/presença de bloqueios", critical: false },
            { item: "Indica conduta inicial correta", critical: true },
          ]
        },
      ]
    },
    {
      key: "Fase 3",
      label: "Casos complexos, bioética, liderança",
      stations: [
        {
          title: "Caso interdisciplinar: paciente politraumatizado",
          context: "Treine abordagem inicial, priorizando ABCDE, comunicação com equipe e paciente. Enumere etapas.",
          type: "complexo",
          checklist: [
            { item: "Aplica protocolo ABCDE corretamente", critical: true },
            { item: "Organiza divisão de tarefas na equipe", critical: false },
            { item: "Valoriza segurança global do paciente", critical: true },
            { item: "Solicita exames essenciais com justificativa", critical: false },
            { item: "Registra condutas de forma objetiva", critical: false },
          ]
        }
      ]
    },
    {
      key: "Fase 4",
      label: "Avaliação OSCE Final Integrada",
      stations: [
        {
          title: "Avaliação Full OSCE (caso integrado)",
          context: "Simulação completa: anamnese, exame, conduta e comunicação em caso clínico misto (ex.: emergência hipertensiva em gestante).",
          type: "integrado",
          checklist: [
            { item: "Sequência lógica e segura no atendimento", critical: true },
            { item: "Demonstrou empatia e escuta ativa", critical: false },
            { item: "Fundamentou hipóteses e condutas conforme protocolo SUS/FMRP", critical: true },
            { item: "Manteve comunicação clara com equipe e paciente", critical: true },
            { item: "Completou procedimento essencial corretamente", critical: false },
          ]
        }
      ]
    }
  ];

  let currentPhaseIdx = 0;
  let currentStationIdx = 0;

  // Histórico do usuário
  let userProgress = {
    phaseScores: Array(phases.length).fill(null).map(_=>[]), // [[] for each phase]
    checklistHistory: [], // {phaseIdx, stationIdx, performed, feedback, score}
  };

  // Interface de navegação das fases
  const phasesNav = document.getElementById('phases-nav');
  const stationArea = document.getElementById('station-area');
  const dashboardLabel = document.getElementById('current-phase-label');
  const phasesProgressEl = document.getElementById('phases-progress');
  const stationHistoryEl = document.getElementById('station-history');
  // Renderiza navegação por fases
  function renderPhasesNav() {
    phasesNav.innerHTML = '';
    phases.forEach((p, i) => {
      const btn = document.createElement('button');
      btn.className = 'phase-btn' + (i===currentPhaseIdx?' active':'');
      btn.innerText = p.key;
      btn.onclick = () => { currentPhaseIdx = i; currentStationIdx = 0; renderStations(); renderDashboard(); };
      phasesNav.appendChild(btn);
    });
  }
  
  function renderStations() {
    dashboardLabel.textContent = phases[currentPhaseIdx].label;
    stationArea.innerHTML = '';
    const phase = phases[currentPhaseIdx];
    phase.stations.forEach((st, idx) => {
      const card = document.createElement('div');
      card.className = 'station-card';
      card.innerHTML = `
        <h3>Estação ${idx+1}: ${st.title}</h3>
        <div class="question-block">${st.context}</div>
        <form class="station-form" data-idx="${idx}">
          <div class="input-block">
            <label>Resposta/Simulação:</label>
            <textarea required rows="4" name="roleanswer" placeholder="Descreva como realizaria a tarefa, incluindo falas, decisões, sequência de abordagem..."></textarea>
          </div>
          <button class="btn" type="submit">Avaliar estação</button>
          <div class="station-note">Checklist automatizado baseado na banca FMRP-USP.</div>
        </form>
        <div class="feedback-block" id="feedback-${currentPhaseIdx}-${idx}" style="display:none"></div>
      `;
      stationArea.appendChild(card);
      const form = card.querySelector('.station-form');
      form.onsubmit = (e) => {
        e.preventDefault();
        avaliarEstacao(currentPhaseIdx, idx, st, form.roleanswer.value);
      };
    });
  }
  // IA Simulation (Feedback checklist local)
  function avaliarEstacao(phaseIdx, stationIdx, st, resposta) {
    // Simula avaliação de IA pelo checklist
    const respostasNorm = resposta.toLocaleLowerCase();
    let acertos = 0, total = st.checklist.length;
    let itensAval = [];
    st.checklist.forEach(chk => {
      const norm = chk.item.toLocaleLowerCase().split(/[,;.]/).join("");
      const found = norm.split(" ").some(word => word.length>4 && respostasNorm.includes(word));
      if (found) acertos++;
      itensAval.push({ item: chk.item, ok: found, critical: chk.critical });
    });
    // Score pondera os itens críticos
    let nota = Math.round(100*(acertos/total));
    const feedbacks = [];
    itensAval.forEach((chk, i) => {
      if (chk.ok) {
        feedbacks.push(`<span class="checklist-ok">✔ ${chk.item}${chk.critical?" (essencial)":""}</span>`);
      } else if (chk.critical) {
        feedbacks.push(`<span class="checklist-fail">✘ ${chk.item} (essencial) – ponto a reforçar</span>`);
      } else {
        feedbacks.push(`<span class="checklist-fail">✘ ${chk.item}</span>`);
      }
    });

    // Considera station apenas uma vez por usuário
    if (!userProgress.phaseScores[phaseIdx][stationIdx]) {
      userProgress.phaseScores[phaseIdx][stationIdx] = nota;
      userProgress.checklistHistory.push({
        phaseIdx,
        stationIdx,
        performed: resposta,
        feedback: `${nota} pontos<br>${feedbacks.join('<br>')}`,
        score: nota
      });
    }

    // Mostra feedback
    const feedbackEl = document.getElementById(`feedback-${phaseIdx}-${stationIdx}`);
    feedbackEl.style.display = "block";
    feedbackEl.innerHTML = `<b>Nota: ${nota}</b><br>${feedbacks.join('<br>')}
      <div style="margin-top:8px; color:#13343B;">
      <i>Perfil da banca FMRP: valorização de clareza, segurança, lógica clínica e comunicação efetiva, com rigor em critérios essenciais (checklist crítico).</i>
      </div>
    `;
    formDesabilitar(stationIdx);
    renderDashboard();
  }
  function formDesabilitar(stationIdx) {
    // Após submissão, bloqueia inputs
    document.querySelectorAll('.station-form')[stationIdx].querySelector('textarea').setAttribute("readonly",true);
    document.querySelectorAll('.station-form')[stationIdx].querySelector('button').setAttribute("disabled",true);
  }
  function calcMedia(arr) {
    let v = arr.filter(x=>typeof x==="number");
    return v.length ? Math.round(v.reduce((a,b)=>a+b,0)/v.length) : 0;
  }
  // Dashboard: Evolução do aluno e checklists
  function renderDashboard() {
    // Progresso por fase
    phasesProgressEl.innerHTML = '';
    phases.forEach((ph, i) => {
      const media = calcMedia(userProgress.phaseScores[i]);
      const done = userProgress.phaseScores[i].filter(x=>typeof x==="number").length;
      const total = ph.stations.length;
      phasesProgressEl.innerHTML += `
        <div>${ph.key} (${done}/${total} estações)</div>
        <div class="progress-bar-bg">
          <div class="progress-bar-inner" style="width:${media}%;background:var(--color-primary);">${media}%</div>
        </div>
      `;
    });
    stationHistoryEl.innerHTML = '';
    if (userProgress.checklistHistory.length === 0) {
      stationHistoryEl.innerHTML = '<i>Ainda não há estações avaliadas.</i>';
    } else {
      userProgress.checklistHistory.slice().reverse().forEach(h => {
        let nome = `${phases[h.phaseIdx].key} – ${phases[h.phaseIdx].stations[h.stationIdx].title}`;
        stationHistoryEl.innerHTML += `<div style="margin-bottom:4px;">
          <b>${nome}</b>
          <div>${h.feedback}</div>
          <details><summary>Resposta enviada</summary><pre style="white-space:pre-line; font-size:13px">${h.performed}</pre></details>
        </div>`;
      });
    }
  }
  // Inicialização
  renderPhasesNav();
  renderStations();
  renderDashboard();
</script>
</body>
</html>
